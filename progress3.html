<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous"></script>

  <style>
    ::-webkit-scrollbar { display: none; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #FFFFFF;
      display: flex;
      justify-content: center;
      align-items: start;
      min-height: 100vh;
    }

    /* 칩스 선택 효과 */
    .selected {
      outline: 2px solid #5B9DFF;
      outline-offset: 1px;
      box-shadow: 0 0 0 2px rgba(91,157,255,0.3);
    }

    /* 버튼 상태 */
    .disabled-btn {
      background-color: #E0E0E0;
      color: #A0A0A0;
      cursor: not-allowed;
    }
    .active-btn {
      background-color: #5B9DFF;
      color: white;
      cursor: pointer;
    }

    textarea::placeholder {
      font-size: 14px;
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'brand-blue': '#5B9DFF',
            'chip-green': '#EAF3E9',
            'chip-orange': '#FDF0E7',
            'chip-pink': '#F9F1F0',
            'chip-blue': '#E9F4FF',
            'chip-white': '#F8F9FA',
            'chip-mint': '#EEF7F5',
            'chip-amber': '#FFF8E9',
            'chip-sky': '#EEF5FB',
            'gray-text': '#4A4A4A'
          }
        }
      }
    }
  </script>
</head>

<body>
  <div class="w-full max-w-[375px] mx-auto bg-white min-h-screen flex flex-col rounded-2xl shadow-lg overflow-hidden">

    <!-- 헤더 -->
    <header class="flex items-center justify-between p-4 border-b border-gray-100">
      <button id="backBtn" class="text-gray-500">
        <i class="fas fa-chevron-left fa-lg"></i>
      </button>
      <h1 class="text-base font-medium text-gray-800">인터뷰 - 그 사람을 떠올리기</h1>
      <div class="w-6"></div>
    </header>

    <!-- 메인 -->
    <main class="flex-grow p-5 overflow-y-auto">

      <!-- 진행률 -->
      <div class="text-center mb-8">
        <p class="text-xs text-gray-500 mb-2">3/3 단계</p>
        <div class="w-full bg-gray-200 rounded-full h-1.5">
          <div class="bg-sky-400 h-1.5 rounded-full" style="width: 100%"></div>
        </div>
      </div>

      <!-- 안내 텍스트 -->
      <div class="text-center mb-8">
        <p class="text-gray-700 text-base">첫 편지를 쓰기 전, 그 사람을 떠올려요</p>
      </div>

      <!-- 추억의 사진 추가 -->
      <section class="bg-white p-6 rounded-2xl shadow-sm mb-4">
        <h3 class="text-base font-medium text-gray-text mb-4">추억의 사진을 추가하시겠어요?</h3>
        <div class="flex flex-col items-center">
          <!-- 사진 프레임 -->
          <div id="photoPreviewContainer" class="relative w-28 h-28 rounded-full bg-gray-100 flex items-center justify-center mb-4 overflow-hidden">
            <!-- 기본 회색 유저 아이콘 -->
            <i id="defaultUserIcon" class="fas fa-user text-gray-400 text-4xl"></i>

            <!-- 업로드된 사진 -->
            <img id="photoPreview" class="absolute inset-0 w-full h-full object-cover hidden" alt="추억의 사진" />

            <!-- 삭제 버튼 -->
            <button id="removePhotoBtn" 
                    class="hidden absolute top-4 right-4 bg-black bg-opacity-70 text-white w-6 h-6 flex items-center justify-center rounded-full shadow-md">
              <i class="fas fa-times text-sm"></i>
            </button>
          </div>

          <!-- 업로드 버튼 -->
          <input type="file" id="photoUpload" accept="image/*" class="hidden">
          <button onclick="document.getElementById('photoUpload').click()" 
                  class="border border-gray-300 text-gray-600 font-medium py-2.5 px-12 rounded-lg text-sm hover:bg-gray-50 transition-colors">
            사진 업로드
          </button>

          <p class="text-xs text-gray-400 text-center mt-4 leading-relaxed">
            추억을 떠올리는 데 도움이 됩니다.<br>
            사진은 편지함에서만 보이며 외부로 전송되지 않습니다.
          </p>
        </div>
      </section>

      <!-- 성격 & 추억 -->
      <section class="bg-white p-6 rounded-2xl shadow-sm mb-4">
        <h3 class="text-base font-medium text-gray-text mb-4">
          그 분의 성격은?
        </h3>
        <div id="chipGroup" class="grid grid-cols-2 gap-3 mb-6">
          <button class="bg-chip-pink text-gray-text py-3 rounded-xl text-sm hover:opacity-80">온화함</button>
          <button class="bg-chip-green text-gray-text py-3 rounded-xl text-sm hover:opacity-80">활발함</button>
          <button class="bg-chip-orange text-gray-text py-3 rounded-xl text-sm hover:opacity-80">신중함</button>
          <button class="bg-chip-blue text-gray-text py-3 rounded-xl text-sm hover:opacity-80">유머러스</button>
        </div>

        <h3 class="text-base font-medium text-gray-text mb-4">함께했던 특별한 추억이 있다면?</h3>
        <textarea id="memoryInput" 
                  class="w-full h-24 p-4 border border-gray-200 rounded-xl resize-none focus:ring-2 focus:ring-brand-blue focus:border-transparent transition text-sm placeholder-gray-400"
                  placeholder="예: 매일 저녁 함께 산책했던 기억..."></textarea>
      </section>

      <!-- 작성 팁 -->
      <section class="bg-white p-5 rounded-2xl shadow-sm mb-4">
        <div class="flex items-start space-x-3">
          <span class="text-yellow-400 text-lg mt-0.5"><i class="fa-solid fa-lightbulb"></i></span>
          <div>
            <h4 class="font-bold text-sm text-gray-text mb-1">편지 작성 팁</h4>
            <p class="text-xs text-gray-500 leading-relaxed">
              이 정보들은 AI가 그분의 말투를 더 정확하게 재현하는 데 도움이 됩니다. 정확할수록 더욱 그분다운 편지를 받으실 수 있어요.
            </p>
          </div>
        </div>
      </section>
    </main>

    <!-- 하단 버튼 -->
    <footer class="p-4 bg-white sticky bottom-0">
      <button id="completeBtn" class="w-full py-4 rounded-2xl transition-all disabled-btn" disabled>
        완료
      </button>
    </footer>
  </div>

  <script>
    const chips = document.querySelectorAll('#chipGroup button');
    const memoryInput = document.getElementById('memoryInput');
    const completeBtn = document.getElementById('completeBtn');
    const photoUpload = document.getElementById('photoUpload');
    const photoPreview = document.getElementById('photoPreview');
    const defaultUserIcon = document.getElementById('defaultUserIcon');
    const removePhotoBtn = document.getElementById('removePhotoBtn');
    const backBtn = document.getElementById('backBtn');

    let isPersonalitySelected = false;

    // 뒤로가기
    backBtn.addEventListener('click', () => {
      window.history.back();
    });

    // 칩스 선택
    chips.forEach(btn => {
      btn.addEventListener('click', () => {
        if (btn.classList.contains('selected')) {
          btn.classList.remove('selected');
          isPersonalitySelected = false;
        } else {
          chips.forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          isPersonalitySelected = true;
        }
        updateCompleteBtnState();
      });
    });

    // 텍스트 입력
    memoryInput.addEventListener('input', updateCompleteBtnState);

    // 완료 버튼 활성화
    function updateCompleteBtnState() {
      if (isPersonalitySelected && memoryInput.value.trim().length > 0) {
        completeBtn.disabled = false;
        completeBtn.classList.remove('disabled-btn');
        completeBtn.classList.add('active-btn');
      } else {
        completeBtn.disabled = true;
        completeBtn.classList.add('disabled-btn');
        completeBtn.classList.remove('active-btn');
      }
    }

    // 완료 버튼 → complete.html
    completeBtn.addEventListener('click', () => {
      if (!completeBtn.disabled) {
        window.location.href = 'complete.html';
      }
    });

    // 사진 업로드
    photoUpload.addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = ev => {
          photoPreview.src = ev.target.result;
          photoPreview.classList.remove('hidden');
          defaultUserIcon.classList.add('hidden');
          removePhotoBtn.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    // 사진 삭제
    removePhotoBtn.addEventListener('click', () => {
      photoPreview.src = '';
      photoPreview.classList.add('hidden');
      defaultUserIcon.classList.remove('hidden');
      removePhotoBtn.classList.add('hidden');
      photoUpload.value = '';
    });
  </script>
</body>
</html>
