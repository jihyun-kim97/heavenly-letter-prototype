<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous"></script>
  <style>
    ::-webkit-scrollbar { display: none; }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>

<body class="bg-white font-[Noto Sans KR] flex items-center justify-center h-[812px]">
  <!-- ✅ 모바일 프레임: 375×812 -->
  <div class="w-[375px] h-[812px] bg-white shadow-2xl overflow-hidden relative">

    <!-- 헤더 -->
    <header class="px-4 py-4 flex items-center justify-center relative">
      <button onclick="location.href='index.html'" class="absolute left-4 text-gray-500 hover:text-blue-500 transition">
        <i class="fa-solid fa-house fa-lg"></i>
      </button>
      <h1 class="text-lg font-medium text-gray-700">편지 캘린더</h1>
    </header>

    <!-- 메인 -->
    <main class="px-6 pt-4 pb-8 h-full overflow-y-auto">
      <!-- 월 네비게이션 -->
      <section class="flex items-center justify-between mb-4">
        <button id="prev-month" class="text-gray-500 hover:text-blue-500">
          <i class="fa-solid fa-chevron-left fa-xl"></i>
        </button>
        <h2 id="month-title" class="text-2xl font-bold text-gray-700"></h2>
        <button id="next-month" class="text-gray-500 hover:text-blue-500">
          <i class="fa-solid fa-chevron-right fa-xl"></i>
        </button>
      </section>

      <!-- 달력 -->
      <section>
        <div class="bg-white rounded-2xl p-4 shadow">
          <div id="calendar-grid" class="grid grid-cols-7 gap-y-2 text-center">
            <div class="font-medium text-gray-400 text-sm">일</div>
            <div class="font-medium text-gray-400 text-sm">월</div>
            <div class="font-medium text-gray-400 text-sm">화</div>
            <div class="font-medium text-gray-400 text-sm">수</div>
            <div class="font-medium text-gray-400 text-sm">목</div>
            <div class="font-medium text-gray-400 text-sm">금</div>
            <div class="font-medium text-gray-400 text-sm">토</div>
          </div>
        </div>

        <div class="mt-4 flex items-center justify-center gap-6">
          <div class="flex items-center gap-2">
            <div class="w-2 h-2 bg-yellow-400 rounded-full"></div>
            <span class="text-sm text-gray-500">답장 편지가 도착한 날</span>
          </div>
          <div class="flex items-center gap-2">
            <div class="w-0 h-0 border-l-[6px] border-l-transparent border-b-[6px] border-b-blue-400"></div>
            <span class="text-sm text-gray-500">내가 편지를 보낸 날</span>
          </div>
        </div>
      </section>

      <!-- 편지 카드 -->
      <section id="letter-section" class="mt-6 opacity-0 transition-all">
        <div id="selected-date-title" class="mb-4">
          <h3 class="text-lg font-medium text-gray-700">날짜를 선택해주세요</h3>
        </div>
        <div id="letter-cards-container" class="space-y-3"></div>
        <div id="sent-letters-container" class="space-y-3 mt-6"></div>
        <div id="no-letters-message" class="hidden text-center py-12 text-sm text-gray-400">
          해당 날짜에는 편지가 없습니다.
        </div>
      </section>
    </main>
  </div>

<script>
  // 아이콘/컬러
  function getIcon(a){
    return a==='cloud'?'fa-solid fa-cloud':a==='dog'?'fa-solid fa-dog':'fa-solid fa-user-tie';
  }
  function getColor(a){
    return a==='cloud'?'from-blue-200 to-blue-300':a==='dog'?'from-orange-200 to-orange-300':'from-green-200 to-green-300';
  }

  // 1~12월 편지 데이터
  const letterData={
    "2025-10-07":[{sender:"친구",avatar:"cloud",preview:"10월 7일! 오늘 편지 도착",date:"10월 7일"}],
    "2025-10-22":[{sender:"삼촌",avatar:"user-tie",preview:"가을이네 건강 챙겨라",date:"10월 22일"}],
    "2025-10-30":[{sender:"뽀미",avatar:"dog",preview:"멍멍! 단풍 예뻐",date:"10월 30일"}],
    "2025-11-05":[{sender:"친구",avatar:"cloud",preview:"11월 시작이네!",date:"11월 5일"}],
    "2025-11-15":[{sender:"삼촌",avatar:"user-tie",preview:"감기 조심하자",date:"11월 15일"}],
    "2025-11-28":[{sender:"뽀미",avatar:"dog",preview:"추워 멍멍",date:"11월 28일"}],
    "2025-12-05":[{sender:"친구",avatar:"cloud",preview:"12월이다! 연말이야",date:"12월 5일"}],
    "2025-12-24":[{sender:"삼촌",avatar:"user-tie",preview:"메리 크리스마스!",date:"12월 24일"}],
    "2025-12-31":[{sender:"뽀미",avatar:"dog",preview:"새해 준비 멍!",date:"12월 31일"}],
  };

  const sentLetters={};
  for(const k in letterData){
    const [y,m,d]=k.split('-');
    sentLetters[k]=[{title:"보낸 편지",preview:"오늘의 마음을 전했어요.",date:`${+m}월 ${+d}일`}];
  }

  const today=new Date();
  let currentYear=today.getFullYear();
  let currentMonth=today.getMonth();

  const monthTitle=document.getElementById('month-title');
  const grid=document.getElementById('calendar-grid');
  const letterSection=document.getElementById('letter-section');
  const title=document.getElementById('selected-date-title');
  const letterBox=document.getElementById('letter-cards-container');
  const sentBox=document.getElementById('sent-letters-container');
  const noMsg=document.getElementById('no-letters-message');

  function renderCalendar(){
    monthTitle.textContent=`${currentYear}년 ${currentMonth+1}월`;
    grid.querySelectorAll('.calendar-date').forEach(e=>e.remove());
    const firstDay=new Date(currentYear,currentMonth,1).getDay();
    const lastDate=new Date(currentYear,currentMonth+1,0).getDate();

    for(let i=0;i<firstDay;i++){
      const empty=document.createElement('div');
      grid.appendChild(empty);
    }

    for(let d=1;d<=lastDate;d++){
      const cell=document.createElement('div');
      cell.className='calendar-date py-3 cursor-pointer hover:bg-gray-50 rounded relative text-gray-700';
      cell.dataset.date=d;
      cell.textContent=d;

      const key=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
      if(letterData[key]){
        const dot=document.createElement('div');
        dot.className='w-1.5 h-1.5 bg-yellow-400 rounded-full mx-auto mt-1';
        cell.appendChild(dot);
      }
      grid.appendChild(cell);
    }
    attachDateEvents();

    // 오늘 날짜 선택
    if(currentYear===today.getFullYear() && currentMonth===today.getMonth()){
      const todayCell=[...document.querySelectorAll('.calendar-date')].find(c=>+c.dataset.date===today.getDate());
      if(todayCell) todayCell.click();
    } else {
      letterSection.style.opacity='0';
      title.innerHTML='<h3 class="text-lg font-medium text-gray-700">날짜를 선택해주세요</h3>';
    }
  }

  function attachDateEvents(){
    document.querySelectorAll('.calendar-date').forEach(c=>{
      c.addEventListener('click',()=>{
        document.querySelectorAll('.calendar-date').forEach(e=>e.classList.remove('bg-yellow-100'));
        c.classList.add('bg-yellow-100');
        title.innerHTML=`<h3 class="text-lg font-medium text-gray-700">${currentMonth+1}월 ${c.dataset.date}일의 편지</h3>`;
        renderLetters(c.dataset.date);
      });
    });
  }

  function renderLetters(day){
    letterBox.innerHTML='';
    sentBox.innerHTML='';
    noMsg.classList.add('hidden');
    const key=`${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
    const replies=letterData[key]||[];
    const sent=sentLetters[key]||[];

    if(replies.length===0 && sent.length===0){
      noMsg.classList.remove('hidden');
      letterSection.style.opacity='1';
      return;
    }

    // ✅ 받은 편지 카드
    replies.forEach(l=>{
      letterBox.innerHTML+=`
        <div onclick="location.href='recipient.html'"
             class="bg-white rounded-xl p-4 shadow hover:shadow-lg cursor-pointer">
          <div class="flex items-start gap-3">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br ${getColor(l.avatar)} flex items-center justify-center">
              <i class="${getIcon(l.avatar)} text-white text-sm"></i>
            </div>
            <div class="flex-1">
              <div class="flex justify-between mb-1">
                <h4 class="font-bold text-gray-700">${l.sender}</h4>
                <span class="text-xs text-gray-400">${l.date}</span>
              </div>
              <p class="text-sm text-gray-500 line-clamp-2">${l.preview}</p>
            </div>
          </div>
        </div>`;
    });

    // ✅ 보낸 편지 카드
    sent.forEach(s=>{
      sentBox.innerHTML+=`
        <div onclick="location.href='recipient.html'"
             class="bg-blue-50 rounded-xl p-4 border border-blue-100 shadow hover:shadow-lg cursor-pointer">
          <div class="flex items-start gap-3">
            <div class="w-10 h-10 rounded-full bg-blue-400 flex items-center justify-center">
              <i class="fa-solid fa-paper-plane text-white text-sm"></i>
            </div>
            <div class="flex-1">
              <div class="flex justify-between mb-1">
                <h4 class="font-bold text-gray-700">${s.title}</h4>
                <span class="text-xs text-gray-400">${s.date}</span>
              </div>
              <p class="text-sm text-gray-500 line-clamp-2">${s.preview}</p>
            </div>
          </div>
        </div>`;
    });

    letterSection.style.opacity='1';
  }

  document.getElementById('prev-month').addEventListener('click',()=>{
    if(currentMonth===0){currentMonth=11;currentYear--;} else currentMonth--;
    renderCalendar();
  });

  document.getElementById('next-month').addEventListener('click',()=>{
    if(currentMonth===11){currentMonth=0;currentYear++;} else currentMonth++;
    renderCalendar();
  });

  renderCalendar();
</script>
</body>
</html>
