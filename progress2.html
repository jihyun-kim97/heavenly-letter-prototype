<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js" crossorigin="anonymous"></script>

  <style>
    ::-webkit-scrollbar { display: none; }
    body {
      font-family: 'Noto Sans KR', sans-serif;
      background: #ffffff;
      display: flex;
      justify-content: center;
      align-items: start;
      min-height: 100vh;
    }
    /* 선택 효과 */
    .selected {
      outline: 2px solid #5B9DFF;
      outline-offset: 1px;
      box-shadow: 0 0 0 2px rgba(91,157,255,0.3);
    }
    /* 하단 버튼 */
    .sticky-bottom-btn {
      position: sticky;
      bottom: 0;
      font-weight: 500;
      font-size: 16px;
      padding: 14px 0;
      text-align: center;
      width: 100%;
      border: none;
      border-radius: 0.75rem;
      margin-top: 1rem;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .sticky-bottom-btn:disabled {
      background-color: #E0E0E0;
      color: #A0A0A0;
      cursor: not-allowed;
    }
    .sticky-bottom-btn.active {
      background-color: #5B9DFF;
      color: white;
      cursor: pointer;
    }
  </style>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'custom-green': '#EAF3E9',
            'custom-orange': '#FDF0E7',
            'custom-blue': '#E9F4FF',
            'custom-rose': '#F9F1F0',
            'custom-white': '#F8F9FA',
            'custom-mint': '#EEF7F5',
            'custom-amber': '#FFF8E9',
            'custom-sky': '#EEF5FB',
          }
        }
      }
    }
  </script>
</head>

<body>
  <div class="w-full max-w-[375px] mx-auto bg-white h-[812px] shadow-lg flex flex-col rounded-2xl overflow-hidden">
    <!-- 헤더 -->
    <header class="flex items-center justify-between p-4 border-b border-gray-100">
      <button id="backBtn" class="text-gray-500" type="button" aria-label="뒤로가기">
        <i class="fas fa-chevron-left fa-lg"></i>
      </button>
      <h1 class="text-base font-medium text-gray-800">인터뷰 - 그 사람을 떠올리기</h1>
      <div class="w-6"></div>
    </header>

    <main class="flex-grow p-5 overflow-y-auto">
      <!-- 진행률 -->
      <div class="text-center mb-8">
        <p class="text-xs text-gray-500 mb-2">2/3 단계</p>
        <div class="w-full bg-gray-200 rounded-full h-1.5">
          <div class="bg-sky-400 h-1.5 rounded-full" style="width: 66%"></div>
        </div>
      </div>

      <div class="text-center mb-8">
        <p class="text-gray-700 text-base">첫 편지를 쓰기 전, 그 사람을 떠올려요</p>
      </div>

      <div class="space-y-6">
        <!-- 나이대 -->
        <section class="bg-white rounded-2xl shadow-sm p-6">
          <h2 class="text-base font-medium text-gray-800 mb-5">그분의 나이대는?</h2>
          <div class="grid grid-cols-2 gap-3" id="ageButtons">
            <button class="bg-custom-blue text-gray-700 py-3 rounded-xl text-sm" type="button">어린이</button>
            <button class="bg-custom-green text-gray-700 py-3 rounded-xl text-sm" type="button">청년</button>
            <button class="bg-custom-orange text-gray-700 py-3 rounded-xl text-sm" type="button">중장년</button>
            <button class="bg-custom-sky text-gray-700 py-3 rounded-xl text-sm" type="button">노년</button>
          </div>
        </section>

        <!-- 사투리 -->
        <section class="bg-white rounded-2xl shadow-sm p-6">
          <h2 class="text-base font-medium text-gray-800 mb-5">지역 사투리나 특징이 있었나요?</h2>
          <div class="grid grid-cols-2 gap-3" id="dialectButtons">
            <button class="bg-custom-blue text-gray-700 py-3 rounded-xl text-sm" type="button">서울/경기</button>
            <button class="bg-custom-green text-gray-700 py-3 rounded-xl text-sm" type="button">부산/경상도</button>
            <button class="bg-custom-orange text-gray-700 py-3 rounded-xl text-sm" type="button">전라도</button>
            <button class="bg-custom-sky text-gray-700 py-3 rounded-xl text-sm" type="button">충청도</button>
            <button class="bg-custom-mint text-gray-700 py-3 rounded-xl text-sm" type="button">강원도</button>
            <button class="bg-custom-amber text-gray-700 py-3 rounded-xl text-sm" type="button">제주도</button>
          </div>
          <!-- ✅ id 부여 -->
          <button id="noDialectBtn" class="w-full mt-3 py-3 text-sm font-medium text-gray-700 bg-custom-white border border-gray-200 rounded-xl" type="button">
            특별한 사투리는 없었어요
          </button>
        </section>

        <!-- 자주 쓰시던 말 -->
        <section class="bg-white rounded-2xl shadow-sm p-6">
          <h2 class="text-base font-medium text-gray-800 mb-5">자주 쓰시던 말이 있나요?</h2>
          <input id="phraseInput" type="text" placeholder="예: '괜찮다', '사랑한다', '고마워' 등"
                 class="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#5B9DFF]/50 mb-5">
          <div class="flex flex-row gap-3 flex-wrap" id="phraseButtons">
            <button class="bg-custom-green text-gray-700 px-4 py-2 text-sm rounded-full" type="button">괜찮다</button>
            <button class="bg-custom-orange text-gray-700 px-4 py-2 text-sm rounded-full" type="button">사랑한다</button>
            <button class="bg-custom-blue text-gray-700 px-4 py-2 text-sm rounded-full" type="button">고마워</button>
            <button class="bg-custom-amber text-gray-700 px-4 py-2 text-sm rounded-full" type="button">잘했어</button>
          </div>
        </section>

        <button id="nextBtn" class="sticky-bottom-btn" type="button" disabled>다음</button>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const nextBtn = document.getElementById('nextBtn');
      const phraseInput = document.getElementById('phraseInput');
      const backBtn = document.getElementById('backBtn');
      const noDialectBtn = document.getElementById('noDialectBtn');
      const ageGroup = document.querySelector('#ageButtons');
      const dialectGroup = document.querySelector('#dialectButtons');

      // 뒤로가기
      backBtn.addEventListener('click', () => window.history.back());

      // 항상 깨끗하게 시작 (복원 필요 없으면 유지)
      localStorage.removeItem('progressSelections');

      const saveSelections = () => {
        const age = ageGroup.querySelector('.selected')?.textContent.trim() || '';
        const dialectFromGrid = dialectGroup.querySelector('.selected')?.textContent.trim() || '';
        const dialect =
          dialectFromGrid || (noDialectBtn.classList.contains('selected') ? '특별한 사투리는 없었어요' : '');
        const phrase = phraseInput.value.trim();
        localStorage.setItem('progressSelections', JSON.stringify({ age, dialect, phrase }));
      };

      const updateNextButtonState = () => {
        const ageSelected = !!ageGroup.querySelector('.selected');
        const dialectSelected = !!dialectGroup.querySelector('.selected') || noDialectBtn.classList.contains('selected');
        const phraseFilled = phraseInput.value.trim().length > 0;

        if (ageSelected && dialectSelected && phraseFilled) {
          nextBtn.disabled = false;
          nextBtn.classList.add('active');
        } else {
          nextBtn.disabled = true;
          nextBtn.classList.remove('active');
        }
      };

      // 공통 단일선택 바인딩
      const enableSingleSelect = (container, onSelectExtra = () => {}) => {
        container.querySelectorAll('button').forEach(btn => {
          btn.addEventListener('click', () => {
            if (btn.classList.contains('selected')) {
              btn.classList.remove('selected');
            } else {
              container.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
              btn.classList.add('selected');
            }
            onSelectExtra(); // 그리드 외 버튼 해제/처리용
            saveSelections();
            updateNextButtonState();
          });
        });
      };

      // 나이대: 기본 단일선택
      enableSingleSelect(ageGroup);

      // 사투리 그리드: 클릭 시 "없었어요" 해제
      enableSingleSelect(dialectGroup, () => noDialectBtn.classList.remove('selected'));

      // "특별한 사투리는 없었어요" 토글
      noDialectBtn.addEventListener('click', () => {
        if (noDialectBtn.classList.contains('selected')) {
          noDialectBtn.classList.remove('selected');
        } else {
          dialectGroup.querySelectorAll('button').forEach(b => b.classList.remove('selected'));
          noDialectBtn.classList.add('selected');
        }
        saveSelections();
        updateNextButtonState();
      });

      // 말버튼 ↔ 입력 상호배타
      const phraseChips = document.querySelectorAll('#phraseButtons button');
      phraseChips.forEach(btn => {
        btn.addEventListener('click', () => {
          if (btn.classList.contains('selected')) {
            btn.classList.remove('selected');
            phraseInput.value = '';
          } else {
            phraseChips.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            phraseInput.value = btn.textContent.trim();
          }
          saveSelections();
          updateNextButtonState();
        });
      });

      phraseInput.addEventListener('input', () => {
        if (phraseInput.value.trim().length > 0) {
          phraseChips.forEach(b => b.classList.remove('selected'));
        }
        saveSelections();
        updateNextButtonState();
      });

      nextBtn.addEventListener('click', () => {
        if (!nextBtn.disabled) {
          saveSelections();
          window.location.href = 'roading.html';
        }
      });

      // 초기 상태 계산
      updateNextButtonState();
    });
  </script>
</body>
</html>
